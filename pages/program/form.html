<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>前往报名-吉粮保险</title>
		<meta name="author" content=""/>
		<meta name="keywords" content="吉粮保险"/>
		<meta name="description" content="吉粮保险,吉粮团意险"/>
		<meta name="renderer" content="webkit">
		<meta http-equiv= "X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, minimal-ui, viewport-fit=cover">
		<meta name="telephone=no" content="format-detection">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		
		<meta name="charData" content="http://dl.jlhmsh.com/program/img/xiaochengxu-baoxian.png"/>
		<meta name="params" content="title=吉粮保险&desc=吉粮团意险&path=pages/index/index&userName=gh_bebacf990e20&webpageUrl=http://back.jlhmsh.com/ppsh/login.html&hdImageData=http://img03.jlhmsh.com/201803/08/f52715ecbcf548ceb92e00b84ebaf548.jpg"/>
		<!--<meta name="format-detection" content="telephone=no">
		<meta http-equiv="x-rim-auto-match" content="none">
		<meta http-equiv="Pragma" contect="no-cache">-->
		
		<link rel="stylesheet" type="text/css" href="../../public/css/init.css"/>
		<link rel="stylesheet" type="text/css" href="../../public/css/btn.css"/>
		<link rel="stylesheet" type="text/css" href="style/style.css"/>
		<link rel="stylesheet" type="text/css" href="../../public/js/modal/modal.css"/>
	</head>
	<body class="" ontouchstart>
		<img src="img/program.jpg" class="img-all" alt="吉粮团体保障计划会员权益"/>
		<form class="section">
			<div class="headline">
				<p>个人资料</p>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					姓名：</label>
				<input class="form-item-right" type="text" name="" id="username" tabindex="1" autocomplete="off" required value="" placeholder="中、英文"/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					身份证号：</label>
				<input class="form-item-right" type="text" name="" id="idnumber" tabindex="2" autocomplete="off" required value="" placeholder="15、18位身份证号"/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					手机号码：</label>
				<input class="form-item-right" type="tel" name="" id="tel"  tabindex="3" autocomplete="off" required value="" placeholder="11位手机号"/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					电子邮箱：</label>
				<input class="form-item-right" type="email" name="" id="email"  tabindex="4" autocomplete="off" required value="" placeholder=""/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					职业：</label>
				<input class="form-item-right" type="text" name="" id="job"  tabindex="5" autocomplete="off" required value="" placeholder=""/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					推荐人：</label>
				<input class="form-item-right" type="text" name="" id="referee"  tabindex="5" autocomplete="off" required value="" placeholder="推荐人手机号码"/>
			</div>
			<div class="headline">
				<p>默认不可更改</p>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					被保险人：</label>
				<input class="form-item-right" type="text" name="" id="policyHolder" value="本人" disabled/>
			</div>
			<!--<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					被保险人：</label>
				<select class="form-item-right form-select" name="">
					<option value="本人" selected>本人</option>
					<option value="本人" selected>本人</option>
					<option value="本人" selected>本人</option>
				</select>
			</div>-->
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					投保份数：</label>
				<input class="form-item-right" type="text" name="" id="number" value="1份" disabled/>
			</div>
			<div class="form-item">
				<p class="form-item-left"><span class="cl-red">*</span>
					保险受益人：</p>
					<div class="form-item-right">
						<input type="checkbox" name="beneficiary" id="beneficiary" checked value="法定受益人" disabled/>
						<label for="" style="color: #999;">法定受益人</label>
					</div>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					保险费：</label>
				<input class="form-item-right" type="text" name="" id="cost" value="999元" disabled/>
			</div>
			<!--<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					生效日期：</label>
				<input class="form-item-right" type="text" name="" id="date" value="yyy-mm-dd"  disabled/>
			</div>-->
			
			<!--<div class="form-item">
				<p class="form-item-left"><span class="cl-red">*</span>
					被保险人：</p>
					<div class="form-item-right">
						<input type="radio" name="" id="job" value="本人" tabindex="5" checked />
						<label for="">本人</label>
					</div>
			</div>-->
			<div class="headline">
				<p>确认</p>
			</div>
			<p class="padding-left-right margin-top-no" style="line-height: 2;">
				<input type="checkbox" name="clause" id="clauseConsent" required value="consent" />
				<label for="clauseConsent">本人已充分了解本保险产品，并承诺投保信息的真实性，理解并同意:</label>
				<a class="link-a" href="clause/Insurance-information.html">《投保须知》</a>
				<a class="link-a" href="clause/Insurance-declaration.html">《投保声明》</a>
				<a class="link-a" href="clause/subjoin-renshenyiwai.html">《保险条款》</a>
				<a class="link-a" href="clause/claims-guide.html">《理赔指南》</a>
				<a class="link-a" href="clause/occupational-classification.html">《职业分类》</a>
			</p>
			<p>				
				<button class="btn btn-all btn-main btn-submit" > 提交订单 </button>				
			</p>
		</form>
	</body>
	<script type="text/javascript">
		//如果是测试连接
		if(location.host == '192.168.1.176' && typeof VConsole != 'function') {
			document.write("<script language=\"javascript\" src=\"http:\/\/192.168.1.176/hmsh-agent-web\/src\/main\/webapp\/mobile-new\/js\/vconsole.min.js\" > <\/script><script>var v = new VConsole();<\/script>");
		}
	</script>
	<script src="../../public/js/zepto/zepto.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="style/jquery.form.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../public/js/modal/modal.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		function testVal() {
		       			$('#username').val('ze');//姓名
			       		$('#idnumber').val('362513158846644');//身份证
			       		$('#tel').val('15997111111');//手机号码
			       		$('#email').val('8150546@qq.com');//电子邮件
			       		$('#job').val('it');//职业
			       		$('#referee').val('15899222222');//推荐人手机号
		       }
		$(function(){
			if(location.origin == "http://192.168.1.176"){
				var url_reserve = 'http://192.168.1.182:8083/ins_order/save.do';
				$('form').before('<a class="btn btn-green" onclick="testVal()">填充表单</a>');
			}else if(/server=test/i.test(location.search)){//url后带参数?server=test
				var url_reserve = 'http://admin.jlhmsh-test.com/'+'ins_order/save.do';
				$('form').before('<a class="btn btn-green" onclick="testVal()">填充表单</a>');
			}else{
				var url_reserve = 'http://back.jlhmsh.com'+'/ins_order/save.do';
			}
			console.log(url_reserve);
			/*
			new Date(1511228236874).format('yyyy-MM-dd hh:mm:ss')
			* */
			Date.prototype.format = function(style) {
						var o = {
							"M+" : this.getMonth() + 1, //month
							"d+" : this.getDate(),      //day
							"h+" : this.getHours(),     //hour
							"m+" : this.getMinutes(),   //minute
							"s+" : this.getSeconds(),   //second
							"w+" : "\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".charAt(this.getDay()),   //week
							"q+" : Math.floor((this.getMonth() + 3) / 3),  //quarter
							"S"  : this.getMilliseconds() //millisecond
						};
						if (/(y+)/.test(style)) {
							style = style.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
						}
						for(var k in o){
							if (new RegExp("("+ k +")").test(style)){
								style = style.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
							}
						}
						return style;
			};
			//姓名
			$username = $('#username').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.name.test( _this.val() );
				inputDispoce(_this,judge);
				//同步被保险人
				$policy.val( _this.val() );
				inputDispoce($policy,judge);
				delete _this;
			});
			//身份证号
			$idnumber = $('#idnumber').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.idNumber.test( _this.val() );
				inputDispoce(_this,judge);
				delete _this;
			})
			//联系电话
			$tel = $('#tel').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.phone.test( _this.val() );
				inputDispoce(_this,judge);
				delete _this;
			})
			//电子邮箱
			$email = $('#email').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.email.test( _this.val() );
				inputDispoce(_this,judge);
				delete _this;
			})
			//职业
			$job = $('#job').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.name.test( _this.val() ); //使用name校检职业字符串
				inputDispoce(_this,judge);
				delete _this;
			})
			//推荐人
			$referee = $('#referee').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.phone.test( _this.val() );
				inputDispoce(_this,judge);
				delete _this;
			})
			//被保险人
			$policy = $('#policyHolder');
			//投保份数
			$number = $('#number');
			//保险受益人
			$beneficiary = $('#beneficiary');
			//保险费
			$cost = $('#cost');
			//生效日期
//			var $date = $('#date').val(new Date().format('yyyy-MM-dd'));
			//确定协议
			var $consent = $('#clauseConsent');
			//提交按钮
			$submit = $('.btn-submit');
			
			//提交事件
			$('form').submit(function (e) {
				judgeForm();
				/**/
				e.preventDefault();
				return false;
			})
			
			//提交全校验
			function judgeForm() {
				//验证必填字段
		        if(!reg.name.test($username.val())){
		        	JudegFormError($username,'姓名不符合规范');
		        	return false;
		        }else if(!reg.idNumber.test($idnumber.val())){
		        	JudegFormError($idnumber,'身份证号不符合规范');
		        	return false;
		        }else if(!reg.phone.test($tel.val())){
		        	JudegFormError($tel,'手机号不符合规范');
		        	return false;
		        }else if(!reg.email.test($email.val())){
		        	JudegFormError($email,'邮箱不符合规范');
		        	return false;
		        }else if(!reg.name.test($job.val())){
		        	JudegFormError($job,'职业不符合规范');
		        	return false;
		        }else if(!$consent.prop('checked')){
		        	JudegFormError($consent,'未确认条款');
		        	return false;
		        }else if($referee.val().length>0 && !reg.phone.test($referee.val())){
		        	JudegFormError($referee,'推荐人手机号不符合');
		        	return false;
		        }
		        /*ajax*/
		       $.ajax({
		       	type:"post",
		       	url:url_reserve,
		       	dataType:'json',
		       	data:{
		       		name:$username.val(),//姓名
		       		idCard:$idnumber.val(),//身份证
		       		phone:$tel.val(),//手机号码
		       		email:$email.val(),//电子邮件
		       		occupation:$job.val(),//职业
		       		referee:$referee.val(),//推荐人手机号
		       		insurant:$policy.val(),//被保险人
		       		number:parseInt($number.val())||1,//投保份数
		       		beneficiary:$beneficiary.val(),//保险受益人
		       		premium:parseInt($cost.val())||999,//保险费
		       	},
		       	beforeSend:function(){
		       		loading();
		       	},
		       	success:function(data,status,xhr){
		       		if(data.status == 10000){
		       			modal('恭喜，'+data.info+'！');
		       			setTimeout(function () {
		       				location.replace('index.html');
		       			},500)
		       		}else{
		       			modal(data.info);
		       		}
		       	},
		       	complete:function (xhr,status) {
		       		
		       	},
		       	error:function(xhr,status,errorText){
		       		modal('error:'+errorText);
		       	}
				
		       });
			}
			function JudegFormError($input,text) {
		        $input.trigger('focus').parent().addClass('error');
		        modal(text);
			}
			//单个input公共处理
			function inputDispoce($input,judge) {
				//添加/溢出error状态
				judge ? $input.parent('.form-item').removeError() : $input.parent('.form-item').addError();
				//确认按钮
				//judge ? $submit.removeDisabled() : $submit.addDisabled();
				delete $input;
			}
			
		})
	</script>
</html>
