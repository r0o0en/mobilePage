<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>前往报名-吉粮保险</title>
		<meta name="author" content=""/>
		<meta name="keywords" content="吉粮保险"/>
		<meta name="description" content="吉粮保险,吉粮团意险"/>
		<meta name="renderer" content="webkit">
		<meta http-equiv= "X-UA-Compatible" content="chrome=1,IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, minimal-ui, viewport-fit=cover">
		<meta name="telephone=no" content="format-detection">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		
		<meta name="charData" content="http://dl.jlhmsh.com/program/img/xiaochengxu-baoxian.png"/>
		<meta name="params" content="title=吉粮保险&desc=吉粮团意险&path=pages/index/index&userName=gh_bebacf990e20&webpageUrl=http://back.jlhmsh.com/ppsh/login.html&hdImageData=http://img03.jlhmsh.com/201803/08/f52715ecbcf548ceb92e00b84ebaf548.jpg"/>
		<!--<meta name="format-detection" content="telephone=no">
		<meta http-equiv="x-rim-auto-match" content="none">
		<meta http-equiv="Pragma" contect="no-cache">-->
		
		<link rel="stylesheet" type="text/css" href="../../public/css/init.css"/>
		<link rel="stylesheet" type="text/css" href="../../public/css/btn.css"/>
		<link rel="stylesheet" type="text/css" href="style/style.css"/>
		<link rel="stylesheet" type="text/css" href="../../public/js/modal/modal.css"/>
	</head>
	<body class="" ontouchstart>
		<a class="fixed fixed-btn btn btn-green" href="order.html">我的订单</a>
		<img src="img/program.jpg" class="img-all" alt="吉粮团体保障计划会员权益"/>
		<form class="section">
			<div class="headline">
				<p>个人资料</p>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>姓名：</label>
				<input class="form-item-right" type="text" name="" id="username" tabindex="1" autocomplete="off" required value="" placeholder="中、英文"/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					身份证号：</label>
				<input class="form-item-right" type="text" name="" id="idnumber" tabindex="2" autocomplete="off" required value="" placeholder="15、18位身份证号"/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					手机号码：</label>
				<input class="form-item-right" type="tel" name="" id="tel"  tabindex="3" autocomplete="off" required value="" placeholder="11位手机号"/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					电子邮箱：</label>
				<input class="form-item-right" type="email" name="" id="email"  tabindex="4" autocomplete="off" required value="" placeholder=""/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					职业：</label>
				<input class="form-item-right" type="text" name="" id="job"  tabindex="5" autocomplete="off" required value="" placeholder=""/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					保险专员：</label>
				<input class="form-item-right" type="text" name="" id="referee"  tabindex="5" autocomplete="off" value="" placeholder="保险专员手机号码"/>
				<input class="form-item-right" type="hidden" name="" id="refereeId" placeholder="保险专员验证Id"/>
			</div>
			<div class="headline">
				<p>默认不可更改</p>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					被保险人：</label>
				<input class="form-item-right" type="text" name="" id="policyHolder" value="本人" disabled/>
			</div>
			<!--<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					被保险人：</label>
				<select class="form-item-right form-select" name="">
					<option value="本人" selected>本人</option>
					<option value="本人" selected>本人</option>
					<option value="本人" selected>本人</option>
				</select>
			</div>-->
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					投保份数：</label>
				<input class="form-item-right" type="text" name="" id="number" value="1份" disabled/>
			</div>
			<div class="form-item">
				<p class="form-item-left"><span class="cl-red">*</span>
					保险受益人：</p>
					<div class="form-item-right">
						<input type="checkbox" name="beneficiary" id="beneficiary" checked value="法定受益人" disabled/>
						<label for="" style="color: #999;">法定受益人</label>
					</div>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					保险费：</label>
				<input class="form-item-right" type="text" name="" id="cost" value="999元" disabled/>
			</div>
			<div class="form-item">
				<label class="form-item-left" for=""><span class="cl-red">*</span>
					生效日期：</label>
				<input class="form-item-right" type="text" name="" id="date" value="以保险结算时间为准"  disabled/>
			</div>
			
			<div class="headline">
				<p>确认</p>
			</div>
			<p class="padding-left-right margin-top-no" style="line-height: 2;">
				<input type="checkbox" name="clause" id="clauseConsent" required value="consent" />
				<label for="clauseConsent">本人已充分了解本保险产品，并承诺投保信息的真实性，理解并同意:</label>
				<a class="link-a" href="clause/Insurance-information.html">《投保须知》</a>
				<a class="link-a" href="clause/Insurance-declaration.html">《投保声明》</a>
				<a class="link-a" href="clause/subjoin-renshenyiwai.html">《保险条款》</a>
				<a class="link-a" href="clause/claims-guide.html">《理赔指南》</a>
				<a class="link-a" href="clause/occupational-classification.html">《职业分类》</a>
			</p>
			<p>
				<button class="btn btn-all btn-main btn-submit" > 提交订单 </button>				
			</p>
		</form>
	</body>

	<script src="../../public/js/zepto/zepto.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../public/js/modal/modal.js" type="text/javascript" charset="utf-8"></script>
	
	<script src="style/cookies.js" type="text/javascript" charset="utf-8"></script>
	<script src="style/init.js" type="text/javascript" charset="utf-8"></script>
	<script src="style/jquery.form.js" type="text/javascript" charset="utf-8"></script>

	<script type="text/javascript">
		needLogin = false;
		
		$(function() {
			testVal = function () {
				$('#username,#policyHolder').val('ze'); //姓名
				$('#idnumber').val('362513158846644'); //身份证
				$('#tel').val('15997111111'); //手机号码
				$('#email').val('8150546@qq.com'); //电子邮件
				$('#job').val('it'); //职业
				$('#referee').val('15997448183'); //保险专员手机号
				//$('#refereeId').val('2510214861651968'); //保险专员手机号
				judgeReferee= true;
			}

			if(SERVER === 0) {//如果是本地或测试,显示填充按钮
				$('form').before('<a class="btn btn-green" onclick="testVal()">填充表单</a>');
			}
			/*获取保险参数*/
			var insuranceInfo = {};
			ajax({
				info:'获取保险详情',
				infosuccess:false,
				type:"get",
				url:URLS.getInsuranceInfo,
				success:function(data){
					insuranceInfo = data.data[0];
					$('#cost').val(data.data[0].fee);
				}
			})
			
			//姓名
			var $username = $('#username').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.name.test( _this.val() );
				inputDispoce(_this,judge);
				//同步被保险人
				$policy.val( _this.val() );
				inputDispoce($policy,judge);
				delete _this;
			});
			//身份证号
			var $idnumber = $('#idnumber').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.idNumber.test( _this.val() );
				inputDispoce(_this,judge);
				delete _this;
			})
			//联系电话
			var $tel = $('#tel').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.phone.test( _this.val() );
				inputDispoce(_this,judge);
				delete _this;
			})
			//电子邮箱
			var $email = $('#email').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.email.test( _this.val() );
				inputDispoce(_this,judge);
				delete _this;
			})
			//职业
			var $job = $('#job').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.name.test( _this.val() ); //使用name校检职业字符串
				inputDispoce(_this,judge);
				delete _this;
			})
			//保险专员Id
			var $refereeId = $('#refereeId');
			//保险专员
			var judgeReferee = false;
			var $referee = $('#referee').watch(function (e) {
				var _this = $(this);
				//判断
				var judge = reg.phone.test( _this.val());
				inputDispoce(_this,judge);
				judgeReferee = judge;
//				if(judge){//满足手机格式
//					if(judgeReferee==false){//且没有进行验证 or 前一次验证不成功
//						ajax({
//							info:'验证保险专员',
//							needLogin:false,
//							infosuccess:true,
//							url:URLS.postJudgeReferee,
//							data:{
//								phone:_this.val()
//							},
//							success:function(data){
//								if(data.data){
//									//如果保险专员有效
//									judgeReferee = true;
//									$refereeId.val(data.data.dmId);								
//									console.log('验证保险专员成功',judgeReferee,$refereeId.val());
//								}
//							}
//						})						
//					}
//				}else{
//					judgeReferee = false;
//					$refereeId.val('');
//				}
				_this = null;
			});
			//被保险人
			var $policy = $('#policyHolder');
			//投保份数
			var $number = $('#number');
			//保险受益人
			var $beneficiary = $('#beneficiary');
			//保险费
			var $cost = $('#cost');
			//生效日期
			var $date = $('#date');
			//确定协议
			var $consent = $('#clauseConsent');
			//提交按钮
			var $submit = $('.btn-submit');
			
			//提交事件
			$('form').submit(function (e) {
				e.preventDefault();
				judgeForm();
				return false;
			})
			//提交全校验
			function judgeForm() {
				//验证必填字段
		        if(!reg.name.test($username.val())){
		        	JudegFormError($username,'姓名不符合规范');
		        	return false;
		        }else if(!reg.idNumber.test($idnumber.val())){
		        	JudegFormError($idnumber,'身份证号不符合规范');
		        	return false;
		        }else if(!reg.phone.test($tel.val())){
		        	JudegFormError($tel,'手机号不符合规范');
		        	return false;
		        }else if(!reg.email.test($email.val())){
		        	JudegFormError($email,'邮箱不符合规范');
		        	return false;
		        }else if(!reg.name.test($job.val())){
		        	JudegFormError($job,'职业不符合规范');
		        	return false;
		        }else if(!$consent.prop('checked')){
		        	JudegFormError($consent,'未确认条款');
		        	return false;
		        }else if( !judgeReferee ){
		        	JudegFormError($referee,'保险专员无效');
		        	return false;
		        }
		        var data = {
			       		insuranceFeeKey:insuranceInfo.key,
			       		name:$username.val(),//姓名
			       		idCard:$idnumber.val(),//身份证
			       		phone:$tel.val(),//手机号码
			       		email:$email.val(),//电子邮件
			       		occupation:$job.val(),//职业
			       		referee:$referee.val(),//保险专员手机号
			       		//refereeId:$refereeId.val(),//保险专员验证ID
			       		insurant:$policy.val(),//被保险人
			       		number:( parseInt($number.val())||1 ) + '',//投保份数
			       		beneficiary:$beneficiary.val(),//保险受益人
			       		//premium:parseInt($cost.val())||999,//保险费
			       		date:$date.val(),//生效日期
			    };
		        console.log('表单提交的数据',data);
		        /*ajax*/
		       	ajax({
					info:'提交保险订单',
					infosuccess:true,
					needLogin:true,
					contentType: "application/json",
					url:URLS.postSubmitOrder,
					data:JSON.stringify(data),
					success:function(data){
						var id = data.data.orderId;
						location.href = URLS.getPushOrder + '?orderId='+id;
					}
				})
		    }
			function JudegFormError($input,text) {
		        $input.trigger('focus').parent().addClass('error');
		        modal(text);
			}
			//单个input公共处理
			function inputDispoce($input,judge) {
				//添加/溢出error状态
				judge ? $input.parent('.form-item').removeError() : $input.parent('.form-item').addError();
				//确认按钮
				//judge ? $submit.removeDisabled() : $submit.addDisabled();
				delete $input;
			}
			
		})
	</script>
</html>
